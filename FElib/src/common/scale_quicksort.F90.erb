!-------------------------------------------------------------------------------
! Warning: This file was generated from <%=__FILE__%>.
!          Do not edit this file.
!-------------------------------------------------------------------------------
#include "scaleFElib.h"
module scale_quicksort
  !-----------------------------------------------------------------------------
  !
  !++ used modules
  !
  use scale_precision

  !-----------------------------------------------------------------------------
  implicit none
  private

  !-----------------------------------------------------------------------------
  !
  !++ Public procedure
  !  

  interface QUICKSORT_exec_with_idx
% for t in ["int", "real_RP"]
    module procedure QUICKSORT_exec_with_idx_<%=t%>
% end
  end interface QUICKSORT_exec_with_idx
  
  public :: QUICKSORT_exec_with_idx

contains
  
  !- private routines -------------------------------------

% for t in [["integer", "int"], ["real(RP)", "real_RP"]]
  subroutine QUICKSORT_exec_with_idx_<%=t[1]%>( npoints, val, indx )
    integer, intent(in) :: npoints
    <%=t[0]%>, intent(inout) :: val(npoints)
    integer, intent(inout) :: indx(npoints)

    !-------------------------------
    call quicksort_core_<%=t[1]%>(val, indx, 1, npoints)
  end subroutine QUICKSORT_exec_with_idx_<%=t[1]%>
% end

  !-- private ------------------------------------------------

% for t in [["integer", "int"], ["real(RP)", "real_RP"]] 
  recursive subroutine quicksort_core_<%=t[1]%>(key, ind, first, last)
    implicit none
    
    <%=t[0]%>, intent(inout) :: key(:)
    integer, intent(inout) :: ind(:)
    integer, intent(in) :: first, last

    <%=t[0]%> :: x, tmp
    integer :: i, j, tmp_i
    !-------------------------------

    x = key( (first + last)/2 )
    i = first
    j = last

    do 
      do while ( key(i) < x )
        i = i + 1
      end do
      do while ( x < key(j) )
        j = j - 1
      end do
      if ( i >= j ) exit
      
      ! swap
      tmp = key(i); key(i) = key(j); key(j) = tmp
      tmp_i = ind(i); ind(i) = ind(j); ind(j) = tmp_i

      i = i + 1; j = j - 1
    end do

    if ( first < i-1 ) call quicksort_core_<%=t[1]%>(key, ind, first, i-1)
    if ( j+1 < last )  call quicksort_core_<%=t[1]%>(key, ind, j+1, last)

    return
  end subroutine quicksort_core_<%=t[1]%>
% end
end module scale_quicksort
